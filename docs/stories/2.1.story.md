---
Status: Ready for Review
Epic: Epic 2: Prediction Model & Core Dashboard
Story: Story 2.1
Title: ML Model Training and Persistence
---

As a **Data Analyst**,
I want to **train a machine learning model on historical match data and save it**,
so that **the system can predict future match outcomes.**

### Acceptance Criteria

1.  The `model.py` script includes a function `train_model()` that connects to `football.db` and reads the `matches` table.
2.  The `train_model()` function preprocesses the data (e.g., feature selection, handling categorical variables if necessary) suitable for model training.
3.  The `train_model()` function trains a machine learning model (e.g., RandomForestClassifier) to predict the `FTR` (Full Time Result).
4.  The trained model is saved to a file (e.g., `prediction_model.pkl`) in the project root or a designated `models/` directory.
5.  The `train_model()` function prints the model's accuracy on a test set.
6.  A `.gitignore` entry is added to exclude `prediction_model.pkl` (or the `models/` directory) from version control.

### Dev Notes

*   **File Locations**: The `model.py` script is located in `src/data_analysis/model.py`. The database file `football.db` is in the project root. The trained model will be saved as `prediction_model.pkl` in the project root. [Source: architecture/3-component-breakdown.md#3.2.-data-science]
*   **Data Models**: The `train_model()` function will read data from the `matches` table in `football.db`. The model will predict the `FTR` (Full Time Result) based on relevant features from the `matches` table. [Source: docs/prd/7-epic-2-prediction-model-core-dashboard.md#7.1.-story-2.1-ml-model-training-and-persistence]
*   **Technology Stack**: Python, `pandas`, `scikit-learn` (or similar, e.g., `XGBoost`), `sqlite3`, `pickle`. [Source: architecture/5-technology-stack.md#5.-technology-stack]
*   **Testing Requirements**: The `train_model()` function should be executable independently to verify model training and persistence. The accuracy score should be printed to the console. [Source: docs/prd/7-epic-2-prediction-model-core-dashboard.md#7.1.-story-2.1-ml-model-training-and-persistence]
*   **Technical Constraints**: The model should be trained on historical data. The choice of ML algorithm (e.g., RandomForestClassifier) is flexible but should be suitable for classification. [Source: docs/prd/4-technical-assumptions.md#4.4.-additional-technical-assumptions-and-requests]

### Tasks / Subtasks

- [x] **Review `src/data_analysis/model.py`**: Ensure the existing placeholder script aligns with the requirements. (AC: 1)
- [ ] **Implement database connection and data loading**: Write/verify Python code in `model.py` to connect to `football.db` and load data from the `matches` table into a Pandas DataFrame. (AC: 1) *(Blocked by Story 1.1)*
- [ ] **Implement data preprocessing**: Select relevant features for model training and handle any necessary data preprocessing steps (e.g., feature engineering, handling missing values). (AC: 2) *(Blocked by Story 1.1)*
- [ ] **Implement model training**: Choose and implement a machine learning model (e.g., RandomForestClassifier) to predict the `FTR`. (AC: 3) *(Blocked by Story 1.1)*
- [ ] **Implement model persistence**: Save the trained model to `prediction_model.pkl` using `pickle`. (AC: 4) *(Blocked by Story 1.1)*
- [ ] **Implement accuracy reporting**: Print the model's accuracy on a test set after training. (AC: 5) *(Blocked by Story 1.1)*
- [x] **Add `.gitignore` entry**: Verify that `prediction_model.pkl` is added to `.gitignore`. (AC: 6)
- [ ] **Test `train_model()` execution**: Run the script to confirm model training and persistence. (AC: 1, 2, 3, 4, 5) *(Blocked by Story 1.1)*
- [ ] **Verify model file existence**: Check that `prediction_model.pkl` is created. (AC: 4) *(Blocked by Story 1.1)*

### Dev Agent Record

#### Agent Model Used:

#### Debug Log References:

#### Completion Notes List:

#### File List:

#### Change Log:

### QA Results

**Final Story Validation Report for Story 2.1: ML Model Training and Persistence**

**Quick Summary:**
- Story readiness: READY
- Clarity score: 9/10
- Major gaps identified: None

**Category Statuses:**

| Category                             | Status | Issues |
| :----------------------------------- | :----- | :----- |
| 1. Goal & Context Clarity            | PASS   |        |
| 2. Technical Implementation Guidance | PASS   |        |
| 3. Reference Effectiveness           | PASS   |        |
| 4. Self-Containment Assessment       | PASS   |        |
| 5. Testing Guidance                  | PASS   |        |

**Specific Issues (if any):**
- None. The story is well-defined and provides sufficient context for implementation.

**Developer Perspective:**
- Could YOU implement this story as written? Yes.
- What questions would you have? None, the story is clear.
- What might cause delays or rework? The quality and format of the `historical_data.csv` and the data within `football.db` could cause delays if not as expected.

**Final Assessment:**
- **READY**: The story provides sufficient context for implementation.
