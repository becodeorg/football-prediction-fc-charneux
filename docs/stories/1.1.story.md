---
Status: Blocked
Epic: Epic 1: Foundation & Data Ingestion
Story: Story 1.1
Title: Database Setup and Historical Data Ingestion
---

As a **Data Engineer**,
I want to **set up the SQLite database and ingest historical match data**,
so that **the system has a foundational dataset for model training and analysis.**

### Acceptance Criteria

1.  The `football.db` SQLite database is created.
2.  A `matches` table is created within `football.db` with a schema capable of storing all relevant columns from the historical CSV data (Date, Time, HomeTeam, AwayTeam, FTHG, FTAG, FTR, and additional statistics/odds).
3.  The provided `historical_data.csv` (or equivalent) is successfully loaded into the `matches` table.
4.  The `db_setup.py` script is executable and idempotent (can be run multiple times without error, replacing existing data if necessary).
5.  A `.gitignore` entry is added to exclude `football.db` from version control.

### Dev Notes

*   **File Locations**: The `db_setup.py` script is located in `src/data_engineering/db_setup.py`. The historical data CSV is expected at `data/historical_data.csv`. The database file `football.db` will be created in the project root. [Source: architecture/3-component-breakdown.md#3.1.-data-engineering]
*   **Data Models**: The `matches` table schema should accommodate all columns from the `football-data.co.uk` CSV, including `Date`, `Time`, `HomeTeam`, `AwayTeam`, `FTHG`, `FTAG`, `FTR`, and additional statistics (shots, fouls, cards, etc.) and historical odds. The `db_setup.py` script already uses `pd.to_sql` which infers schema from the DataFrame, but explicit column types might be needed for robustness in a real scenario. [Source: docs/prd/6-epic-1-foundation-data-ingestion.md#6.1.-story-1.1-database-setup-and-historical-data-ingestion]
*   **Technology Stack**: Python, SQLite, Pandas. [Source: architecture/5-technology-stack.md#5.-technology-stack]
*   **Testing Requirements**: The `db_setup.py` script should be executable independently to verify database creation and data loading. Idempotency should be tested by running the script multiple times. [Source: docs/prd/6-epic-1-foundation-data-ingestion.md#6.1.-story-1.1-database-setup-and-historical-data-ingestion]
*   **Technical Constraints**: The database should be SQLite for MVP. [Source: docs/prd/4-technical-assumptions.md#4.4.-additional-technical-assumptions-and-requests]

### Tasks / Subtasks

- [ ] **Review `src/data_engineering/db_setup.py`**: Ensure the existing placeholder script aligns with the requirements. (AC: 4)
- [ ] **Verify `data/historical_data.csv` existence**: Confirm the CSV file is present and contains the expected data. If not, inform the user. (AC: 3)
- [ ] **Implement database creation logic**: Write/verify Python code in `db_setup.py` to connect to SQLite and create `football.db`. (AC: 1)
- [ ] **Implement table schema definition**: Ensure the `matches` table is created with appropriate columns to match the CSV data. (AC: 2)
- [ ] **Implement data loading from CSV**: Write/verify code to read `historical_data.csv` into a Pandas DataFrame and load it into the `matches` table. (AC: 3)
- [ ] **Ensure idempotency**: Add logic to `db_setup.py` to handle re-runs gracefully (e.g., dropping table before recreation). (AC: 4)
- [ ] **Add `.gitignore` entry**: Verify that `football.db` is added to `.gitignore`. (AC: 5)
- [ ] **Test `db_setup.py` execution**: Run the script to confirm database creation and data loading. (AC: 1, 2, 3)
- [ ] **Verify database content**: Connect to `football.db` and query the `matches` table to confirm data integrity. (AC: 3)

### Dev Agent Record

#### Agent Model Used:

#### Debug Log References:

#### Completion Notes List:

#### File List:

#### Change Log:

### QA Results

**Final Story Validation Report for Story 1.1: Database Setup and Historical Data Ingestion**

**Quick Summary:**
- Story readiness: READY
- Clarity score: 9/10
- Major gaps identified: None

**Category Statuses:**

| Category                             | Status | Issues |
| :----------------------------------- | :----- | :----- |
| 1. Goal & Context Clarity            | PASS   |        |
| 2. Technical Implementation Guidance | PASS   |        |
| 3. Reference Effectiveness           | PASS   |        |
| 4. Self-Containment Assessment       | PASS   |        |
| 5. Testing Guidance                  | PASS   |        |

**Specific Issues (if any):**
- None. The story is well-defined and provides sufficient context for implementation.

**Developer Perspective:**
- Could YOU implement this story as written? Yes.
- What questions would you have? None, the story is clear.
- What might cause delays or rework? If the `historical_data.csv` is not provided or is in an unexpected format, it would cause a delay.

**Final Assessment:**
- **READY**: The story provides sufficient context for implementation.
